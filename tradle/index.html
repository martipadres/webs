<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Wordle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif; 
            touch-action: manipulation; /* Prevents jhjhdouble-tap to zoom on mobile */
        }
        .tile {
            position: relative; /* Needed for the absolute positioning of front/back faces */
            transition: transform 0.6s, background-color 0.3s, border-color 0.3s;
            transform-style: preserve-3d;
        }
        .tile.flip {
            transform: rotateX(180deg);
        }
        .tile .front, .tile .back {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .tile .back {
            transform: rotateX(180deg);
        }
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .key {
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-between min-h-screen p-2 sm:p-4">

    <!-- Header -->
    <header class="w-full max-w-md text-center py-4 relative">
        <a href="about.html" id="about-btn" class="absolute left-2 top-1/2 -translate-y-1/2 text-sm bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
            About
        </a>
        <h1 class="text-3xl sm:text-4xl font-bold tracking-wider uppercase">Tradle</h1>
        <p class="text-gray-400">Translate the Spanish word</p>
        <!-- Stats Counter -->
        <div class="flex justify-center gap-8 mt-4 text-lg">
            <div>
                <span id="success-count" class="font-bold text-2xl">0</span>
                <p class="text-xs text-gray-400 uppercase tracking-widest">Successes</p>
            </div>
            <div>
                <span id="played-count" class="font-bold text-2xl">0</span>
                <p class="text-xs text-gray-400 uppercase tracking-widest">Played</p>
            </div>
        </div>
    </header>

    <!-- Spanish Word Display -->
    <div id="spanish-word-container" class="my-2 text-center">
        <p class="text-lg text-gray-300 mb-1">Translate this word:</p>
        <p id="spanish-word" class="text-2xl sm:text-3xl font-bold text-teal-400 bg-gray-800 px-4 py-2 rounded-lg"></p>
    </div>

    <!-- Game Grid -->
    <main id="game-grid" class="grid gap-1.5 mb-6" style="grid-template-rows: repeat(5, 1fr);"></main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-20 bg-gray-700 text-white px-6 py-3 rounded-lg text-lg font-semibold opacity-0 transition-opacity duration-300">
        Message
    </div>

    <!-- On-screen Keyboard -->
    <div id="keyboard" class="w-full max-w-lg lg:max-w-xl mx-auto">
        <div class="flex justify-center gap-1 sm:gap-1.5 my-1">
            <!-- Keyboard rows will be generated by JS -->
        </div>
    </div>
    
    <!-- Next Word Button (Initially Hidden) -->
    <button id="next-word-btn" class="hidden my-4 bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-all">
        Next Word
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const gameGrid = document.getElementById('game-grid');
            const keyboardContainer = document.getElementById('keyboard');
            const spanishWordEl = document.getElementById('spanish-word');
            const toastEl = document.getElementById('toast');
            const nextWordBtn = document.getElementById('next-word-btn');
            const successCountEl = document.getElementById('success-count');
            const playedCountEl = document.getElementById('played-count');

            // --- Game State ---
            let wordList = [];
            let currentSpanishWord = '';
            let currentEnglishWord = '';
            let currentRowIndex = 0;
            let currentColIndex = 0;
            let isGameOver = false;
            let successes = 0;
            let wordsPlayed = 0;
            const MAX_TRIES = 5;

            // --- Word Bank ---
            const initialWords = [
                { spanish: 'hola', english: 'hello' },
                { spanish: 'adiós', english: 'goodbye' },
                { spanish: 'gato', english: 'cat' },
                { spanish: 'perro', english: 'dog' },
                { spanish: 'casa', english: 'house' },
                { spanish: 'libro', english: 'book' },
                { spanish: 'agua', english: 'water' },
                { spanish: 'sol', english: 'sun' },
                { spanish: 'luna', english: 'moon' },
                { spanish: 'amigo', english: 'friend' },
                { spanish: 'jugar', english: 'play' },
                { spanish: 'comer', english: 'eat' },
                { spanish: 'beber', english: 'drink' },
                { spanish: 'rojo', english: 'red' },
                { spanish: 'verde', english: 'green' },
                { spanish: 'azul', english: 'blue' },
                { spanish: 'grande', english: 'big' },
                { spanish: 'feliz', english: 'happy' },
            ];

            // --- Keyboard Layout ---
            const keyboardLayout = [
                'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p',
                'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l',
                'enter', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 'backspace'
            ];
            
            // --- Initialization ---
            function init() {
                wordList = [...initialWords];
                updateStatsDisplay();
                setupNewWord();
                createKeyboard();
            }

            // --- Game Setup ---
            function setupNewWord() {
                if (wordList.length === 0) {
                    showToast("You've completed all words!", 5000);
                    isGameOver = true;
                    nextWordBtn.classList.add('hidden');
                    return;
                }

                isGameOver = false;
                currentRowIndex = 0;
                currentColIndex = 0;

                const wordIndex = Math.floor(Math.random() * wordList.length);
                const wordPair = wordList.splice(wordIndex, 1)[0];
                currentSpanishWord = wordPair.spanish;
                currentEnglishWord = wordPair.english;

                spanishWordEl.textContent = currentSpanishWord.charAt(0).toUpperCase() + currentSpanishWord.slice(1);
                createGrid();
                resetKeyboard();
                nextWordBtn.classList.add('hidden');
            }

            function createGrid() {
                gameGrid.innerHTML = '';
                gameGrid.style.gridTemplateColumns = `repeat(${currentEnglishWord.length}, 1fr)`;
                
                for (let r = 0; r < MAX_TRIES; r++) {
                    for (let c = 0; c < currentEnglishWord.length; c++) {
                        const tile = document.createElement('div');
                        tile.classList.add('tile', 'w-14', 'h-14', 'sm:w-16', 'sm:h-16', 'border-2', 'border-gray-600');
                        
                        const front = document.createElement('div');
                        front.classList.add('front', 'absolute', 'w-full', 'h-full', 'flex', 'items-center', 'justify-center', 'text-2xl', 'font-bold', 'uppercase');
                        
                        const back = document.createElement('div');
                        back.classList.add('back', 'absolute', 'w-full', 'h-full', 'flex', 'items-center', 'justify-center', 'text-2xl', 'font-bold', 'uppercase');

                        tile.appendChild(front);
                        tile.appendChild(back);
                        gameGrid.appendChild(tile);
                    }
                }
            }

            function createKeyboard() {
                keyboardContainer.innerHTML = '';
                const rows = [
                    keyboardLayout.slice(0, 10),
                    keyboardLayout.slice(10, 19),
                    keyboardLayout.slice(19)
                ];

                rows.forEach(row => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'flex justify-center gap-1 sm:gap-1.5 my-1';
                    row.forEach(key => {
                        const keyBtn = document.createElement('button');
                        keyBtn.className = 'key h-12 rounded-md font-semibold uppercase flex items-center justify-center bg-gray-500 hover:bg-gray-600';
                        keyBtn.textContent = key;
                        keyBtn.dataset.key = key;

                        if (key === 'enter' || key === 'backspace') {
                            keyBtn.classList.add('px-3', 'sm:px-4', 'text-xs');
                        } else {
                            keyBtn.classList.add('w-8', 'sm:w-10');
                        }
                        
                        rowDiv.appendChild(keyBtn);
                    });
                    keyboardContainer.appendChild(rowDiv);
                });
            }

            function resetKeyboard() {
                document.querySelectorAll('.key').forEach(key => {
                    key.className = 'key h-12 rounded-md font-semibold uppercase flex items-center justify-center bg-gray-500 hover:bg-gray-600';
                     if (key.dataset.key === 'enter' || key.dataset.key === 'backspace') {
                        key.classList.add('px-3', 'sm:px-4', 'text-xs');
                    } else {
                        key.classList.add('w-8', 'sm:w-10');
                    }
                });
            }

            // --- Event Handlers ---
            document.addEventListener('keydown', e => handleKeyPress(e.key.toLowerCase()));
            keyboardContainer.addEventListener('click', e => {
                if (e.target.matches('button')) {
                    handleKeyPress(e.target.dataset.key);
                }
            });
            nextWordBtn.addEventListener('click', setupNewWord);

            // --- Core Game Logic ---
            function handleKeyPress(key) {
                if (isGameOver) return;

                if (key === 'enter') {
                    submitGuess();
                } else if (key === 'backspace') {
                    deleteLetter();
                } else if (key.match(/^[a-z]$/)) {
                    addLetter(key);
                }
            }

            function addLetter(letter) {
                if (currentColIndex < currentEnglishWord.length) {
                    const tile = getTile(currentRowIndex, currentColIndex);
                    tile.querySelector('.front').textContent = letter;
                    tile.classList.add('border-gray-400');
                    currentColIndex++;
                }
            }

            function deleteLetter() {
                if (currentColIndex > 0) {
                    currentColIndex--;
                    const tile = getTile(currentRowIndex, currentColIndex);
                    tile.querySelector('.front').textContent = '';
                    tile.classList.remove('border-gray-400');
                }
            }

            function submitGuess() {
                const guess = getCurrentGuess();

                if (guess.length !== currentEnglishWord.length) {
                    showToast('Not enough letters');
                    shakeRow(currentRowIndex);
                    return;
                }

                flipRow(guess);
            }
            
            function flipRow(guess) {
                const targetLetterCount = countLetters(currentEnglishWord);
                const correctIndices = new Set();

                // First pass: Find green (correct position) letters
                for (let i = 0; i < guess.length; i++) {
                    const tile = getTile(currentRowIndex, i);
                    const letter = guess[i];
                    const back = tile.querySelector('.back');
                    back.textContent = letter;

                    if (letter === currentEnglishWord[i]) {
                        updateTileAndKey(tile, letter, 'bg-green-600', 'border-green-600');
                        targetLetterCount[letter]--;
                        correctIndices.add(i);
                    }
                }

                // Second pass: Find yellow (correct letter, wrong position) and gray letters
                for (let i = 0; i < guess.length; i++) {
                    if (correctIndices.has(i)) continue;

                    const tile = getTile(currentRowIndex, i);
                    const letter = guess[i];
                    
                    if (currentEnglishWord.includes(letter) && targetLetterCount[letter] > 0) {
                        updateTileAndKey(tile, letter, 'bg-yellow-500', 'border-yellow-500');
                        targetLetterCount[letter]--;
                    } else {
                        updateTileAndKey(tile, letter, 'bg-gray-700', 'border-gray-700');
                    }
                }
                
                // Animate the flip for each tile in the row
                for (let i = 0; i < guess.length; i++) {
                    const tile = getTile(currentRowIndex, i);
                    setTimeout(() => {
                        tile.classList.add('flip');
                    }, i * 200);
                }
                
                // Check win/loss after animation completes
                setTimeout(() => checkOutcome(guess), guess.length * 200 + 100);
            }

            function checkOutcome(guess) {
                const gameWon = guess === currentEnglishWord;
                const outOfTries = currentRowIndex === MAX_TRIES - 1;

                if (gameWon) {
                    showToast('¡Excelente!', 3000);
                    isGameOver = true;
                    successes++;
                    wordsPlayed++;
                    updateStatsDisplay();
                    nextWordBtn.classList.remove('hidden');
                } else if (outOfTries) {
                    showToast(`The word was: ${currentEnglishWord.toUpperCase()}`, 5000);
                    isGameOver = true;
                    wordsPlayed++;
                    updateStatsDisplay();
                    nextWordBtn.classList.remove('hidden');
                } else {
                    currentRowIndex++;
                    currentColIndex = 0;
                }
            }

            // --- UI & Utility Functions ---
            function updateStatsDisplay() {
                successCountEl.textContent = successes;
                playedCountEl.textContent = wordsPlayed;
            }

            function getTile(row, col) {
                return gameGrid.children[row * currentEnglishWord.length + col];
            }

            function getCurrentGuess() {
                let guess = '';
                for (let i = 0; i < currentColIndex; i++) {
                    guess += getTile(currentRowIndex, i).querySelector('.front').textContent;
                }
                return guess;
            }
            
            function updateTileAndKey(tile, letter, bgColor, borderColor) {
                const back = tile.querySelector('.back');
                back.classList.add(bgColor);
                tile.classList.remove('border-gray-600', 'border-gray-400');
                tile.classList.add(borderColor);
                
                const key = document.querySelector(`.key[data-key="${letter}"]`);
                if (key) {
                    const isGreen = key.classList.contains('bg-green-600');
                    const isYellow = key.classList.contains('bg-yellow-500');
                    const isNewColorGray = bgColor === 'bg-gray-700';

                    if (isGreen) {
                        // Do nothing if already green
                    } else if (isYellow && isNewColorGray) {
                        // Do nothing if already yellow and new color is gray
                    } else {
                        key.classList.remove('bg-gray-500', 'bg-yellow-500');
                        key.classList.add(bgColor);
                    }
                }
            }

            function countLetters(word) {
                return word.split('').reduce((acc, letter) => {
                    acc[letter] = (acc[letter] || 0) + 1;
                    return acc;
                }, {});
            }

            function shakeRow(rowIndex) {
                for (let i = 0; i < currentEnglishWord.length; i++) {
                    const tile = getTile(rowIndex, i);
                    tile.classList.add('shake');
                    tile.addEventListener('animationend', () => tile.classList.remove('shake'), { once: true });
                }
            }

            let toastTimeout;
            function showToast(message, duration = 2000) {
                toastEl.textContent = message;
                toastEl.classList.add('opacity-100');
                clearTimeout(toastTimeout);
                toastTimeout = setTimeout(() => {
                    toastEl.classList.remove('opacity-100');
                }, duration);
            }

            // --- Start the game ---
            init();
        });
    </script>
</body>
</html>
